package awtcomponent1;
import java.awt.*;
import java.awt.event.*;
import java.sql.*;

public class UserRegistrationForm extends Frame implements ActionListener, AdjustmentListener {

    // --- GUI Components ---
    TextField tfFirstName, tfMiddleName, tfLastName, tfEmail;
    TextArea taAddress;
    Scrollbar sbAge;
    Choice chSex, chCity;
    Button btnSave, btnClear; // 1. ADDED: Declaration for the Clear button
    Label lblStatus, lblAgeValue; 
    
    // --- Database Configuration (Instance Variables - Set these!) ---
    String DB_URL = "jdbc:mysql://localhost:3306/Registrationformuser";
    String DB_USER = "root"; // sql username
    String DB_PASSWORD = "Pranita"; // <-- sql pass
    String DB_DRIVER = "com.mysql.cj.jdbc.Driver";

    public UserRegistrationForm() {
        super("User Registration Form");
        this.setLayout(null); // Use null layout for precise component placement
        this.setFont(new Font("SansSerif", Font.PLAIN, 12));

        int yPos = 50; 
        int labelWidth = 100;
        int fieldWidth = 200;
        int fieldHeight = 25;
        int spacing = 35;

        // --- 1. First Name ---
        add(new Label("First Name:  *")).setBounds(50, yPos, labelWidth, fieldHeight);
        tfFirstName = new TextField(20);
        tfFirstName.setBounds(160, yPos, fieldWidth, fieldHeight);
        add(tfFirstName);
        yPos += spacing;

        // --- 2. Middle Name ---
        add(new Label("Middle Name:  *")).setBounds(50, yPos, labelWidth, fieldHeight);
        tfMiddleName = new TextField(20);
        tfMiddleName.setBounds(160, yPos, fieldWidth, fieldHeight);
        add(tfMiddleName);
        yPos += spacing;

        // --- 3. Last Name ---
        add(new Label("Last Name:  *")).setBounds(50, yPos, labelWidth, fieldHeight);
        tfLastName = new TextField(20);
        tfLastName.setBounds(160, yPos, fieldWidth, fieldHeight);
        add(tfLastName);
        yPos += spacing;

        // --- 4. Email ---
        add(new Label("Email:  *")).setBounds(50, yPos, labelWidth, fieldHeight);
        tfEmail = new TextField(20);
        tfEmail.setBounds(160, yPos, fieldWidth, fieldHeight);
        add(tfEmail);
        yPos += spacing;

        // --- 5. Age (Scrollbar) ---
        add(new Label("Age:")).setBounds(50, yPos, labelWidth, fieldHeight);
        
        // Horizontal Scrollbar: (orientation, initial, visible, min, max)
        sbAge = new Scrollbar(Scrollbar.HORIZONTAL, 18, 1, 10, 100); 
        sbAge.setBounds(160, yPos + 5, fieldWidth - 50, fieldHeight - 10);
        sbAge.addAdjustmentListener(this);
        add(sbAge);
        
        lblAgeValue = new Label(String.valueOf(sbAge.getValue()));
        lblAgeValue.setBounds(370, yPos, 40, fieldHeight);
        add(lblAgeValue);
        yPos += spacing;
        
        // --- 6. Sex (Choice/Dropdown) ---
        add(new Label("Sex:")).setBounds(50, yPos, labelWidth, fieldHeight);
        chSex = new Choice();
        chSex.add("Male");
        chSex.add("Female");
        chSex.add("Other");
        chSex.setBounds(160, yPos, fieldWidth, fieldHeight);
        add(chSex);
        yPos += spacing;

        // --- 7. City (Choice/Dropdown) ---
        add(new Label("City:")).setBounds(50, yPos, labelWidth, fieldHeight);
        chCity = new Choice();
        chCity.add("Chh.Sambhajinagar");
        chCity.add("Beed");
        chCity.add("Dhule");
        chCity.add("Pune");
        chCity.add("Mumbai");
        chCity.add("Nashik");
        chCity.add("Nagpur");
        chCity.setBounds(160, yPos, fieldWidth, fieldHeight);
        add(chCity);
        yPos += spacing;
        
        // --- 8. Address (TextArea) ---
        add(new Label("Address:")).setBounds(50, yPos, labelWidth, fieldHeight);
        taAddress = new TextArea("", 3, 20, TextArea.SCROLLBARS_VERTICAL_ONLY); // rows, cols
        taAddress.setBounds(160, yPos, fieldWidth, 60);
        add(taAddress);
        yPos += 70;

        // --- 9. Save and Clear Buttons ---
        btnSave = new Button("Save Data");
        btnSave.setBounds(160, yPos, 100, fieldHeight);
        btnSave.addActionListener(this);
        add(btnSave);
        
        // 2. ADDED: Initialize and place the Clear button next to Save
        btnClear = new Button("Clear Form");
        btnClear.setBounds(270, yPos, 100, fieldHeight);
        btnClear.addActionListener(this);
        add(btnClear);
        // -----------------------------------------------------------
        
        yPos += spacing; 
        
        // --- 10. Status Label ---
        lblStatus = new Label("Ready to register.");
        lblStatus.setBounds(50, yPos, 350, fieldHeight);
        add(lblStatus);
        
        // Frame setup
        this.setSize(450, yPos + 50); // Adjust size dynamically
        this.setVisible(true);
        
        // Window Closing Handler
        addWindowListener(new WindowAdapter() {
            @Override
            public void windowClosing(WindowEvent we) {
                System.exit(0);
            }
        });
    }

    // --- Event Handler for Scrollbar ---
    @Override
    public void adjustmentValueChanged(AdjustmentEvent e) {
        // Update the label to show the current age value
        lblAgeValue.setText(String.valueOf(sbAge.getValue()));
    }
    
    // --- Event Handler for Save and Clear Buttons ---
    @Override
    public void actionPerformed(ActionEvent e) {
        if (e.getSource() == btnSave) {
            saveUserData();
        } else if (e.getSource() == btnClear) { // 3. ADDED: Handle the Clear button press
            clearFormFields();
        }
    }
    
    // --- Helper method to clear all form fields ---
    private void clearFormFields() {
        tfFirstName.setText("");
        tfMiddleName.setText("");
        tfLastName.setText("");
        tfEmail.setText("");
        taAddress.setText("");
        sbAge.setValue(18); // Reset age to the initial value
        lblAgeValue.setText("18"); // Update the label explicitly
        chSex.select(0); // Select the first item ("Male")
        chCity.select(0); // Select the first item ("Chh.Sambhajinagar")
        lblStatus.setText("Form fields cleared.");
    }
    
    // --- JDBC Logic to Save Data ---
    private void saveUserData() {
        // ... (saveUserData method remains the same)
        // 1. Get data from form fields
        String firstName = tfFirstName.getText();
        String middleName = tfMiddleName.getText();
        String lastName = tfLastName.getText();
        String email = tfEmail.getText();
        String address = taAddress.getText();
        int age = sbAge.getValue(); // Get value directly from Scrollbar
        String sex = chSex.getSelectedItem();
        String city = chCity.getSelectedItem();
        
        // Simple validation
        if (firstName.isEmpty() || lastName.isEmpty() || email.isEmpty()) {
            lblStatus.setText("Error: First Name, Last Name, and Email are required.");
            return;
        }

        Connection conn = null;
        PreparedStatement pstmt = null;

        try {
            Class.forName(DB_DRIVER);
            conn = DriverManager.getConnection(DB_URL, DB_USER, DB_PASSWORD);

            // UPDATED SQL: Must match the new table structure below!
            String sql = "INSERT INTO RagisterUserData (first_name, middle_name, last_name, email, address, age, sex, city) VALUES (?, ?, ?, ?, ?, ?, ?, ?)";
            pstmt = conn.prepareStatement(sql);
            
            // Set parameters
            pstmt.setString(1, firstName);
            pstmt.setString(2, middleName);
            pstmt.setString(3, lastName);
            pstmt.setString(4, email);
            pstmt.setString(5, address);
            pstmt.setInt(6, age);
            pstmt.setString(7, sex);
            pstmt.setString(8, city);
            
            int rowsAffected = pstmt.executeUpdate();

            if (rowsAffected > 0) {
                lblStatus.setText("Success! Data saved to database.");
                // Clear fields after successful save
                // Instead of repeating the clear logic, call the helper method
                clearFormFields(); 
                lblStatus.setText("Success! Data saved and fields cleared.");
            } else {
                 lblStatus.setText("Error: Data insertion failed.");
            }

        } catch (ClassNotFoundException e) {
            lblStatus.setText("Error: MySQL JDBC Driver not found.");
        } catch (SQLException e) {
            lblStatus.setText("Database Error: " + e.getMessage());
            e.printStackTrace();
        } finally {
            try {
                if (pstmt != null) pstmt.close();
                if (conn != null) conn.close();
            } catch (SQLException e) {
                System.err.println("Resource closing error: " + e.getMessage());
            }
        }
    }
    
    
}
